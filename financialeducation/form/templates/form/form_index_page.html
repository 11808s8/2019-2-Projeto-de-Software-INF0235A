{% extends "base.html" %}

{% load wagtailcore_tags %}
{% load static %}
{% block body_class %}template-formindexpage{% endblock %}

{% block content %}
    <h1>{{ page.title }}</h1>
    <div class="formulario container">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="renda-tab" data-toggle="tab" data-target="#renda" role="tab" aria-controls="home" aria-selected="true">Rendas</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="despesa-tab" data-toggle="tab" data-target="#despesa" role="tab" aria-controls="profile" aria-selected="false">Despesas</a>
                </li>
            </ul>
            <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="sheet" role="tabpanel" aria-labelledby="renda-tab"></div>
            <div class="tab-pane fade" id="sheet-despesa" role="tabpanel" aria-labelledby="despesa-tab"></div>
            </div>
    </div>
    <!-- Aqui vai o SCRIPT do formulÃ¡rio -->
    <script src="{% static 'js/calx/jquery-calx-2.2.6.min.js' %}" type="text/javascript"></script>
    <script> 
        $('#despesa-tab').on('click', function(){
            // console.log("Teste");
            $('#sheet').removeClass('active');
            $('#sheet').removeClass('show');
            $('#sheet').addClass('fade');
            $('#sheet-despesa').addClass('active');
            $('#sheet-despesa').addClass('show');
            // $('#sheet-despesa').tab();
        });
        $('#renda-tab').on('click', function(){
            // $('#sheet-despesa').removeClass('active');
            // $('#sheet').addClass('active');
            $('#sheet-despesa').removeClass('active');
            $('#sheet-despesa').removeClass('show');
            $('#sheet-despesa').addClass('fade');
            $('#sheet').addClass('active');
            $('#sheet').addClass('show');
            // $('#sheet').tab();
        });
        let idCelulaSoma = 0;
        let idCelulaDespesa = 0;
        let rendas = {{ categories_renda|safe }};
        let despesas = {{ categories_despesa|safe }};
        function montaFormulario(){
            let html = "<h6>Rendas:</h6> <br>";
            for(i=0;i<rendas.length;i++){
                idCelulaSoma ++;
                html += rendas[i][0] + "<input type='text' data-cell='A"+ idCelulaSoma +"' /> <br>";       
            }
            html+= 'Renda:<div style="display:inline" type="text" data-cell="A'+ (idCelulaSoma+1) +'" data-formula="SUM(A1:A'+ idCelulaSoma+')" ></div>';
            $('#sheet').append(html);    

            html = "<div  class='row'><div class='col-md-4 col-sm-4 col-lg-4 col-xs-4'><h6>Despesa:</h6> </div> </div><br>";
            idCelulaSoma++;
            idCelulaDespesa = idCelulaSoma;
            for(i=0;i<despesas.length;i++){
                idCelulaDespesa ++;
                html +="<div  class='row'><div class='col-md-2 col-sm-2 col-lg-2 col-xs-2 justify-content-center'>"+ despesas[i][0] + "</div><div class='col-md-2 col-sm-2 col-lg-2 col-xs-2'><input type='text' data-cell='A"+ idCelulaDespesa +"' /> </div></div><br>";       
            }

            html+= 'Despesas Totais:<div style="display:inline" type="text" data-cell="A'+ (idCelulaDespesa+1) +'" data-formula="SUM(A'+(idCelulaSoma+1)+':A'+ idCelulaDespesa+')"></div>';
            html+='<br>Total:<div style="display:inline" type="text" data-cell="A'+ (idCelulaDespesa+2) +'" data-formula="A'+idCelulaSoma+'-A'+ (idCelulaDespesa+1)+'" ></div>'
            $('#sheet-despesa').append(html);
            $('.formulario').calx();
        }
        montaFormulario({{ categories_renda|safe }});
        
        // function processaRendas(rendas){
        //     $(".formulario").append(_processaArray(rendas,"<h6>Rendas:</h6> <br><ul>"))
        // }

        function _processaArray(array,html){
            for(i=0;i<array.length;i++){
                html += "<li>" + array[i][0] + "</li>";
            }
            html += "</ul>";
            return html;
        }

        function processaDespesas(despesas){
            $(".formulario").append(_processaArray(despesas,"<h6>Despesas:</h6> <br><ul>"))
        }
        
        // PASSA OS ARRAYS DO DJANGO PARA O JAVASCRIPT
        // processaRendas({{ categories_renda|safe }}); 
        // processaDespesas({{ categories_despesa|safe }});

    </script>
    
    
{% endblock %}